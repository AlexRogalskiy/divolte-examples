//
// Copyright 2014 GoDataDriven B.V.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//

divolte.tracking.schema_mapping {
  version = 1
  regexes {
    package-summary = "^http:\\/\\/[a-z0-9]+:[0-9]+((?:\\/[a-z0-9]+)+)/package-summary.html$"
    package-tree = "^http:\\/\\/[a-z0-9]+:[0-9]+((?:\\/[a-z0-9]+)*)/package-tree.html$"
    overview-tree = "^http:\\/\\/[a-z0-9]+:[0-9]+((?:\\/[a-z0-9]+)*)/overview-tree.html$"
    overview-summary = "^http:\\/\\/[a-z0-9]+:[0-9]+((?:\\/[a-z0-9]+)*)/overview-summary.html$"
    deprecated-list = "^http:\\/\\/[a-z0-9]+:[0-9]+((?:\\/[a-z0-9]+)*)/deprecated-list.html$"
    index-all = "^http:\\/\\/[a-z0-9]+:[0-9]+((?:\\/[a-z0-9]+)*)/index-all.html$"
    help-doc = "^http:\\/\\/[a-z0-9]+:[0-9]+((?:\\/[a-z0-9]+)*)/help-doc.html$"
    java-class = "^http:\\/\\/[a-z0-9]+:[0-9]+((?:\\/[a-z0-9]+)+)/([A-Z][A-Za-z]+)\\.html$"

    page = "^http:\\/\\/[a-z0-9]+:[0-9]+(?<package>(?:\\/[a-z0-9]+)+)/(?:(?<type>[A-Z][A-Za-z0-9]+)|[a-z\\-]+)\\.html$"
  }

  fields {
    detectedDuplicate = duplicate
    firstInSession = firstInSession
    timestamp = timestamp
    remoteHost = remoteHost
    referer = referer
    location = location
    viewportPixelWidth = viewportPixelWidth
    viewportPixelHeight = viewportPixelHeight
    screenPixelWidth = screenPixelWidth
    screenPixelHeight = screenPixelHeight
    partyId = partyId
    sessionId = sessionId
    pageViewId = pageViewId
    eventType = eventType

    userAgentString = userAgent
    userAgentName = userAgentName
    userAgentFamily = userAgentFamily
    userAgentVendor = userAgentVendor
    userAgentType = userAgentType
    userAgentVersion = userAgentVersion
    userAgentDeviceCategory = userAgentDeviceCategory
    userAgentOsFamily = userAgentOsFamily
    userAgentOsVersion = userAgentOsVersion
    userAgentOsVendor = userAgentOsVendor

    pageType = {
        type = regex_name
        regexes = [package-summary, package-tree, overview-tree, overview-summary, deprecated-list, index-all, help-doc, java-class]
        field = location
    }
    javaPackage = {
        type = regex_group
        regex = page
        field = location
        group = package
    }
    javaType = {
        type = regex_group
        regex = page
        field = location
        group = type
    }
  }
}
